### **M1（Issue #4 実装ガイド: Gemini API応答スクリプトの作成**

#### **目的**
このIssueでは、GitHub Actionsワークフローから呼び出され、実際にGemini APIと通信して応答を返すJavaScriptスクリプト (`scripts/gemini-reply.js`) を作成します。

#### **前提条件**
*   GitHubリポジトリのSecretsに `GEMINI_API_KEY` が設定済みであること。

---

#### **ステップ1: `scripts` ディレクトリの作成**

まず、スクリプトを配置する `scripts` ディレクトリがまだ存在しない場合は作成します。

```bash
mkdir -p scripts
```

#### **ステップ2: `gemini-reply.js` ファイルの作成**

次に、以下の内容で `scripts/gemini-reply.js` ファイルを作成します。

```javascript
// Google AI SDKをインポート
const { GoogleGenerativeAI } = require("@google/generative-ai");

// 環境変数からAPIキーとコメント本文を取得
const apiKey = process.env.GEMINI_API_KEY;
const commentBody = process.env.COMMENT_BODY;

// Geminiモデルを初期化
const genAI = new GoogleGenerativeAI(apiKey);
const model = genAI.getGenerativeModel({ model: "gemini-pro" });

async function run() {
  try {
    // APIにリクエストを送信
    const result = await model.generateContent(commentBody);
    const response = await result.response;
    const text = response.text();

    // GitHub Actionsの次のステップに返答を渡すための特殊な出力
    // ::set-output name=<キー>::<値>
    console.log(`::set-output name=reply::${text}`);
  } catch (error) {
    console.error("Error calling Gemini API:", error);
    // エラーが発生した場合も、次のステップに渡す
    const errorMessage = "🤖 エラーが発生しました：" + error.message;
    console.log(`::set-output name=reply::${errorMessage}`);
  }
}

run();
```

---

#### **ステップ3: 動作確認**

ファイルを作成したら、以下の手順で動作を確認します。

1.  **変更をコミット＆プッシュ:**
    作成した `scripts/gemini-reply.js` ファイルをリポジトリにコミットし、GitHubにプッシュします。

2.  **ワークフローをトリガー:**
    任意のIssue（またはPR）を開き、コメント欄に `@gemini hello!` のように `@gemini` を含むコメントを投稿します。

3.  **GitHub Actionsのログを確認:**
    リポジトリの「Actions」タブを開き、「Gemini reply」ワークフローの最新の実行ログを確認します。

#### **期待される結果**
*   ワークフローが正常に完了し、緑色のチェックマークが表示される。
*   Issueに、Gemini APIからの実際の返信がコメントとして追加される。
