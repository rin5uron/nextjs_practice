### **M1ï¼ˆIssue #4 å®Ÿè£…ã‚¬ã‚¤ãƒ‰: Gemini APIå¿œç­”ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä½œæˆ**

#### **ç›®çš„**
ã“ã®Issueã§ã¯ã€GitHub Actionsãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‹ã‚‰å‘¼ã³å‡ºã•ã‚Œã€å®Ÿéš›ã«Gemini APIã¨é€šä¿¡ã—ã¦å¿œç­”ã‚’è¿”ã™JavaScriptã‚¹ã‚¯ãƒªãƒ—ãƒˆ (`scripts/gemini-reply.js`) ã‚’ä½œæˆã—ã¾ã™ã€‚

#### **å‰ææ¡ä»¶**
*   GitHubãƒªãƒã‚¸ãƒˆãƒªã®Secretsã« `GEMINI_API_KEY` ãŒè¨­å®šæ¸ˆã¿ã§ã‚ã‚‹ã“ã¨ã€‚

---

#### **ã‚¹ãƒ†ãƒƒãƒ—1: `scripts` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆ**

ã¾ãšã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’é…ç½®ã™ã‚‹ `scripts` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒã¾ã å­˜åœ¨ã—ãªã„å ´åˆã¯ä½œæˆã—ã¾ã™ã€‚

```bash
mkdir -p scripts
```

#### **ã‚¹ãƒ†ãƒƒãƒ—2: `gemini-reply.js` ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ**

æ¬¡ã«ã€ä»¥ä¸‹ã®å†…å®¹ã§ `scripts/gemini-reply.js` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

```javascript
// Google AI SDKã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
const { GoogleGenerativeAI } = require("@google/generative-ai");

// ç’°å¢ƒå¤‰æ•°ã‹ã‚‰APIã‚­ãƒ¼ã¨ã‚³ãƒ¡ãƒ³ãƒˆæœ¬æ–‡ã‚’å–å¾—
const apiKey = process.env.GEMINI_API_KEY;
const commentBody = process.env.COMMENT_BODY;

// Geminiãƒ¢ãƒ‡ãƒ«ã‚’åˆæœŸåŒ–
const genAI = new GoogleGenerativeAI(apiKey);
const model = genAI.getGenerativeModel({ model: "gemini-pro" });

async function run() {
  try {
    // APIã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡
    const result = await model.generateContent(commentBody);
    const response = await result.response;
    const text = response.text();

    // GitHub Actionsã®æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã«è¿”ç­”ã‚’æ¸¡ã™ãŸã‚ã®ç‰¹æ®Šãªå‡ºåŠ›
    // ::set-output name=<ã‚­ãƒ¼>::<å€¤>
    console.log(`::set-output name=reply::${text}`);
  } catch (error) {
    console.error("Error calling Gemini API:", error);
    // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã‚‚ã€æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã«æ¸¡ã™
    const errorMessage = "ğŸ¤– ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸï¼š" + error.message;
    console.log(`::set-output name=reply::${errorMessage}`);
  }
}

run();
```

---

#### **ã‚¹ãƒ†ãƒƒãƒ—3: å‹•ä½œç¢ºèª**

ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ãŸã‚‰ã€ä»¥ä¸‹ã®æ‰‹é †ã§å‹•ä½œã‚’ç¢ºèªã—ã¾ã™ã€‚

1.  **å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆï¼†ãƒ—ãƒƒã‚·ãƒ¥:**
    ä½œæˆã—ãŸ `scripts/gemini-reply.js` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒªãƒã‚¸ãƒˆãƒªã«ã‚³ãƒŸãƒƒãƒˆã—ã€GitHubã«ãƒ—ãƒƒã‚·ãƒ¥ã—ã¾ã™ã€‚

2.  **ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ãƒˆãƒªã‚¬ãƒ¼:**
    ä»»æ„ã®Issueï¼ˆã¾ãŸã¯PRï¼‰ã‚’é–‹ãã€ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ã« `@gemini hello!` ã®ã‚ˆã†ã« `@gemini` ã‚’å«ã‚€ã‚³ãƒ¡ãƒ³ãƒˆã‚’æŠ•ç¨¿ã—ã¾ã™ã€‚

3.  **GitHub Actionsã®ãƒ­ã‚°ã‚’ç¢ºèª:**
    ãƒªãƒã‚¸ãƒˆãƒªã®ã€ŒActionsã€ã‚¿ãƒ–ã‚’é–‹ãã€ã€ŒGemini replyã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æœ€æ–°ã®å®Ÿè¡Œãƒ­ã‚°ã‚’ç¢ºèªã—ã¾ã™ã€‚

#### **æœŸå¾…ã•ã‚Œã‚‹çµæœ**
*   ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒæ­£å¸¸ã«å®Œäº†ã—ã€ç·‘è‰²ã®ãƒã‚§ãƒƒã‚¯ãƒãƒ¼ã‚¯ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã€‚
*   Issueã«ã€Gemini APIã‹ã‚‰ã®å®Ÿéš›ã®è¿”ä¿¡ãŒã‚³ãƒ¡ãƒ³ãƒˆã¨ã—ã¦è¿½åŠ ã•ã‚Œã‚‹ã€‚
