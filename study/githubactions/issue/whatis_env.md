# 💡 環境変数（`process.env`）とは？

プログラムが外部から設定情報を受け取るための仕組みです。

## 👨‍🍳 シェフと秘密の調味料の例え

私たちの`gemini-reply.js`スクリプトを、料理を作る**「シェフ」**に例えてみましょう。
このシェフは、料理を作るために特別な材料、つまり**「秘密の調味料（`GEMINI_API_KEY`）」**が必要です。

### 厳重なキッチンでの作業

シェフはGitHub Actionsという**「特別な、セキュリティが厳重なキッチン」**で料理をします。

この特別なキッチンには、**「キッチンマネージャー（GitHub）」**がいます。
*   あなたは、このキッチンマネージャーにだけ、秘密の調味料の名前と中身（`GEMINI_API_KEY`とその値）を**耳打ち**して教えておきます。（これがGitHubのSecretsに設定する作業です）

*   シェフが料理を始める時、キッチンマネージャーは、シェフにだけ、その秘密の調味料の名前と中身を**そっと耳打ち**して伝えます。

この「そっと耳打ちして伝える」というのが、**「環境変数として渡す」**ということです。

### `process.env` の役割

スクリプトの中の `process.env.GEMINI_API_KEY` という部分は、シェフが「ねぇ、キッチンマネージャー、さっき耳打ちしてくれた『秘密の調味料（`GEMINI_API_KEY`）』って何だったっけ？」と聞いているのと同じなんです。

シェフは秘密の調味料をレシピ（コード）に書き残すことなく、安全に使うことができる、というわけです。

---

つまり、`process.env`は、スクリプトが「今、自分が動いている環境から渡された情報」を受け取るための、Node.jsの**おまじない**のようなものだと考えてください。ファイルとしてどこかに存在するものではありません。

---

## どこから来るの？：`GEMINI_API_KEY` と `COMMENT_BODY` の出所

`process.env`という引き出しの中に、`GEMINI_API_KEY`や`COMMENT_BODY`といった設定がどのようにして入ってくるのか、さらに詳しく見ていきましょう。

### 1. `GEMINI_API_KEY` の場合

*   **出所:** あなたがGitHubリポジトリの「Secrets」に設定した、そのAPIキーの値です。
*   **引き出しへの入れ方:**
    `gemini.yml`のワークフローファイルの中で、以下のように`env:`セクションを使って明示的に指定しています。

    ```yaml
          env:
            GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }} # ここ！
            COMMENT_BODY: ${{ github.event.comment.body }}
    ```
    これは、GitHub Actionsに対して「Secretsにある`GEMINI_API_KEY`の値を、このステップの環境変数`GEMINI_API_KEY`として入れてね」と指示していることになります。

### 2. `COMMENT_BODY` の場合

*   **出所:** ワークフローがトリガーされたGitHubのイベント情報、具体的にはIssueに投稿されたコメントの本文です。
*   **引き出しへの入れ方:**
    `gemini.yml`の同じ`env:`セクションで、以下のように指定しています。

    ```yaml
          env:
            GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
            COMMENT_BODY: ${{ github.event.comment.body }} # ここ！
    ```
    `github.event.comment.body`は、GitHub Actionsがワークフローを実行する際に提供する「イベント情報」の一部です。GitHub Actionsは、このイベント情報からコメント本文を取り出し、`COMMENT_BODY`という環境変数としてスクリプトに渡してくれます。

### まとめ

`env:`セクションは、シェフがキッチンマネージャーに「この料理には、あの秘密の調味料（`GEMINI_API_KEY`）と、今日の特別なお客様からのメッセージ（`COMMENT_BODY`）を耳打ちしてね」と具体的に指示しているようなものです。

これにより、スクリプトは必要な情報を安全かつ確実に受け取ることができるのです。