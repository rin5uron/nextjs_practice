# M2: Geminiに「コードを書いて！」や「コマンドを実行して！」とお願いする方法

このドキュメントでは、Geminiに新しいコードを作ってもらったり、コンピューターでコマンドを実行してもらったりする方法を、もっと分かりやすく説明します。

## 1. Geminiが書く指示のルール
GeminiがGitHub Actionsの中で動く`scripts/gemini-reply.js`のような特定のスクリプトに対して、自分の意図（ファイル変更やコマンド実行）をどのように記述するか、そのための「ルール」
Geminiに「これをしてほしい！」と伝えるための、特別な書き方があります。これを守ると、Geminiがあなたの指示を正確に理解してくれます。

### 2つの主要な指示

*   **「ファイルを作って、または内容を変えて！」とお願いする時**
    *   書き方: `FILE_CHANGE: ファイルの場所: ファイルの中身`
    *   **例1: 新しいファイルを作る**
        *   あなたが「`src/components/Button.tsx` というファイルを作って、中に `export const Button = () => <button>Click me</button>;` と書いてほしい」とGeminiにお願いするなら、こう書きます:
        *   `FILE_CHANGE: src/components/Button.tsx: export const Button = () => <button>Click me</button>;`
    *   **例2: README.md の内容を変える**
        *   「`README.md` の一番上に `# こんにちは、新しいプロジェクト！` と書きたい」なら、こう書きます:
        *   `FILE_CHANGE: README.md: # こんにちは、新しいプロジェクト！`

*   **「このコマンドを実行して！」とお願いする時**
    *   書き方: `RUN_COMMAND: 実行したいコマンド`
    *   **例1: 必要なファイルをインストールする**
        *   「`bun install` というコマンドを実行して、プロジェクトに必要なものをインストールしてほしい」なら、こう書きます:
        *   `RUN_COMMAND: bun install`
    *   **例2: プロジェクトを動く形にする（ビルド）**
        *   「`bun run build` というコマンドを実行して、ウェブサイトを公開できる形にしてほしい」なら、こう書きます:
        *   `RUN_COMMAND: bun run build`

## 2. Geminiの指示をコンピューターが理解する方法（`scripts/gemini-reply.js` のお仕事）

Geminiがあなたのお願いを返事として送ってくれた後、`scripts/gemini-reply.js` というプログラムがその返事を読み解きます。

*   **返事を細かく分ける:** Geminiの返事には、いくつかのお願いがまとめて書かれていることがあります。`scripts/gemini-reply.js` は、それらのお願いを一つ一つに分けます。（例えば、お願いごとに改行が入っていると、それを目印に分けます。）
*   **お願いの種類を見分ける:** `FILE_CHANGE` なのか `RUN_COMMAND` なのか、キーワードを見て、どのお願いなのかを判断します。
*   **必要な情報を取り出す:** 「ファイルの場所」や「ファイルの中身」、「実行したいコマンド」など、それぞれのお願いに必要な情報を取り出します。

## 3. コンピューターが指示を実際に実行する方法（`scripts/gemini-reply.js` の実行部分）

`scripts/gemini-reply.js` は、読み解いたお願いを実際にコンピューターで実行します。

*   **ファイルを作る・変える時:**
    *   Node.js というプログラムの機能を使って、指定された場所にファイルを作ったり、そのファイルに内容を書き込んだりします。（これは、まるであなたがメモ帳でファイルを開いて、文字を書いて保存するようなものです。）
    *   もし、ファイルを作りたい場所にまだフォルダがない場合は、自動的にフォルダも作ってくれます。

*   **コマンドを実行する時:**
    *   Node.js の別の機能を使って、あなたがターミナル（コマンドを入力する黒い画面）でコマンドを打ち込むのと同じように、コンピューターにコマンドを実行させます。
    *   コマンドがうまく動いたか、何かエラーが出たかなども、記録に残すことができます。

## 4. もっとすごい機能（将来の計画）

今はまだできないけれど、将来的にGeminiがもっとできるようになることのアイデアです。

*   **自動で「いいね！」や絵文字をつける:** Geminiが何かをしたら、自動で「👍」のようなリアクションをつけられるようになるかもしれません。
*   **エラーが起きても頑張る:** もし何か問題が起きても、Geminiが自分で何回かやり直したり、決まった時間（例えば60分）が過ぎたら諦めたりするような、もっと賢いエラー対応ができるようになるかもしれません。
*   **エラーメッセージを日本語にする:** 今は英語のエラーメッセージが多いですが、もっと分かりやすい日本語で教えてくれるようになるかもしれません。



```
1. Geminiへのお願いの仕方（指示のルール）とターミナルコマンドの違いについて
       * ターミナルコマンドは、あなたが直接コンピューターに「これを実行して！」と指示するためのものです。
       * Geminiの指示ルール（`FILE_CHANGE`, `RUN_COMMAND`など）は、あなたがGeminiに直接入力するものではありません。これは、Gemini（AI）が、別のプログラム（`scripts/ge
         mini-reply.js`）に対して「こういうことをしてほしい」と伝えるための、決まった形式のメッセージです。
       * Geminiは自由な文章を生成できるため、もし決まった形式がないと、scripts/gemini-reply.jsがGeminiの意図を正確に理解して実行するのが難しくなります。このルールは、
         Geminiとscripts/gemini-reply.jsの間で「こういう形式で指示を出すね」「分かった、この形式なら実行できるよ」という約束事のようなものです。これにより、Geminiが自
         動でコードを生成したり、コマンドを実行したりする仕組みが安全かつ確実に動くようになります。


   2. GitHub Actionsで設定する意味について
       * GitHub Actionsは、コードの変更やIssueの作成など、GitHub上での様々なイベントをきっかけに、自動でタスクを実行できる仕組みです。
       * このGeminiとの連携をGitHub
         Actionsに組み込むことで、例えば「新しい機能を追加してほしい」というIssueが作成されたら、自動的にGeminiがその内容を解釈し、必要なコードを生成したり、関連する
         コマンドを実行したりする、といった自動化が可能になります。手動でGeminiに指示を出す手間を省き、開発プロセスを効率化することが目的です。


   3. M2で何をしたいのか
       * M2の目的は、Geminiがコードベースに対して「ファイルを作成・変更する」「コマンドを実行する」という具体的な操作を行えるようにするための、基本的な「仕組み」を確
         立することです。
       * つまり、「Geminiがどのような形式で指示を出すか（ルール）」と、「その指示をどのように受け取って実行するか（scripts/gemini-reply.jsの役割）」という、Geminiがコ
         ードを操作するための土台作りがM2の目標です。
       * 「ルールを決めたいのか」と「GitHub Actionsでやりたいことを決めたいのか」で言えば、M2は主に「ルールを決め、そのルールに基づいてGeminiがGitHub 
         Actionsを通じてコードを操作できるようにする仕組みを構築する」ことを目指しています。具体的な「やりたいこと」（例:
         「ログインページを作る」「バグを修正する」）は、この仕組みができた後にGeminiに与える「指示」として実現されます。
```