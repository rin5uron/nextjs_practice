# 💡 Next.js 開発トラブルシューティングガイド

このガイドは、Next.js開発中に遭遇するエラーや問題に対し、自力で解決策を見つけるための手順とヒントを提供します。

エラーはバグではなく、成長の機会です。焦らず、一つずつ着実に解決していきましょう。

---

## 🚀 問題解決の基本ステップ

エラーが発生した際、闇雲にコードを修正するのではなく、以下のステップで体系的にアプローチすることが解決への近道です。

### ステップ1️⃣：エラーメッセージを正確に読む

エラー解決の最重要手がかりは、ターミナルやブラウザに表示される**エラーメッセージそのもの**です。

- **何が起きたか (What):** `Error:`, `SyntaxError:` などを確認。
- **どこで起きたか (Where):** ファイル名と行番号を確認。
- **なぜ起きたか (Why):** `Module not found`, `is not defined` などの原因を確認。

まずは焦らず、表示されたメッセージを一行ずつ丁寧に読み解きましょう。

### ステップ2️⃣：エラーメッセージで検索する

意味が分からない場合、**エラーメッセージをそのままコピーしてGoogle検索**するのが最も効果的です。

- **検索のコツ**
    - `"` でエラー文を囲んで完全一致検索。
    - `Next.js`, `React` など関連技術名を追加。

多くの場合、Stack Overflowや技術ブログで同じ問題の解決策が見つかります。

### ステップ3️⃣：状況を切り分ける

原因を特定するために、以下の点をチェックします。

- **直前の変更を疑う:** エラー直前のコード変更が原因の可能性大。`git diff`で変更点を確認し、一旦元に戻してみましょう。
- **依存関係を疑う:** `node_modules` やキャッシュが原因かも。以下のコマンドを試してみてください。
    <details>
      <summary>キャッシュ削除と再インストールのコマンド</summary>
      
      ```bash
      # 1. キャッシュとnode_modulesを削除
      rm -rf .next
      rm -rf node_modules

      # 2. 再度パッケージをインストール
      bun install
      # or npm install
      ```
    </details>
- **環境を疑う:** Node.jsのバージョンや、`.env` ファイルの環境変数は正しいですか？

---

## 🛠️ よくあるエラーの具体例と対処法

### a. 🚨 `EADDRINUSE: address already in use`

- **主な原因:** 開発サーバーで使いたいポート番号が、既に他のアプリに使用されている。
- **簡単な対処法:**
    1.  ポートを使っているアプリを停止する (`lsof -i :<ポート番号>` → `kill -9 <PID>`)。
    2.  別のポート番号で起動する (`bun run dev -- -p <新しいポート番号>`)。

<br>

<details>
  <summary>🔍 ポートの仕組みと詳しい原因</summary>
  
  #### ポートとは？
  コンピュータが通信する際の「窓口番号」のようなものです。
  - **IPアドレス**が建物の「住所」なら、**ポート番号**は「部屋番号」にあたります。
  - Next.jsの開発サーバーは、デフォルトで `3000` 番の窓口（ポート）を使って、ブラウザからのアクセスを待ち受けます。

  #### なぜ「使用中」になるのか？
  重要なルールとして、**「一つのポート（窓口）は、同時に一つのアプリしか使えない」**というものがあります。

  `address already in use` というエラーは、「あなたが使いたい3000番窓口は、既に他の方が使っていますよ」という意味です。
  
  原因としてよくあるのは、以下の状況です。
  1.  以前に起動したNext.jsサーバーが、**正常に終了しないまま**ターミナルを閉じてしまい、見えないところ（バックグラウンド）で動き続けている。
  2.  Next.js以外の**全く別のアプリケーション**が、たまたま同じポート番号を使っている。

  ポートが「壊れた」のではなく、単に「先客がいる」状態なだけです。そのプロセスを終了すれば、また元通り使えるようになります。
</details>

### b. 📦 `Module not found: Can't resolve '...'`

- **主な原因:** 必要なパッケージが未インストール、または`import`のパスが間違っている。
- **対処法:**
    - `bun install <パッケージ名>` でインストールする。
    - `import`文のパスが正しいか（タイポ、階層など）確認する。

### c. ❓ `ReferenceError: ... is not defined`

- **主な原因:** 変数や関数が定義される前に呼ばれている。またはブラウザ専用のAPI (`window`等) をサーバー側で実行しようとしている。
- **対処法:**
    - 変数や関数の定義と呼び出しの順序を確認する。
    - ブラウザ専用APIは `useEffect` の中や `typeof window !== 'undefined'` の条件分岐内で使う。

### d. ✍️ `SyntaxError: ...`

- **主な原因:** コードの文法ミス（括弧の閉じ忘れ、カンマ不足など）。
- **対処法:** エラーが示すファイルと行番号を確認し、修正します。エディタの構文チェック機能が役立ちます。

---

## 🆘 それでも解決しない場合

- **公式ドキュメント:** [Next.js Documentation](https://nextjs.org/docs) が最も信頼できる情報源です。
- **コミュニティに質問する:** Stack OverflowやGitHub Discussionsで質問しましょう。その際、以下の情報を含めると的確な回答が得られやすくなります。
    - ✅ 実現したいこと
    - ❌ 試したこととエラー全文
    - 📝 関連するコード
    - 💻 利用環境 (Next.js, Node.jsのバージョンなど)