name: Gemini reply

on:
  issue_comment:
    types: [created]

permissions:
  issues: write
  contents: write

jobs:
  reply:
    if: contains(github.event.comment.body, '@gemini')
    runs-on: ubuntu-latest
    steps:
      # 1. ãƒªãƒã‚¸ãƒˆãƒªã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆï¼ˆscripts/gemini-reply.jsã‚’èª­ã¿è¾¼ã‚€ãŸã‚ï¼‰
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2. Node.jsç’°å¢ƒã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      # 3. Gemini APIãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
      - name: Install Google AI SDK
        run: npm install @google/generative-ai

      # 4. APIå‘¼ã³å‡ºã—ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã—ã€çµæœã‚’å‡ºåŠ›ã¨ã—ã¦å—ã‘å–ã‚‹
      - name: Call Gemini API
        id: call-gemini-api
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          COMMENT_BODY: ${{ github.event.comment.body }}
        run: node scripts/gemini-reply.js

      # 5. APIã‹ã‚‰ã®è¿”ä¿¡ã‚’Issueã«ã‚³ãƒ¡ãƒ³ãƒˆã™ã‚‹
      - name: Create or update comment with Gemini reply
        uses: peter-evans/create-or-update-comment@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          repository: ${{ github.repository }}
          issue-number: ${{ github.event.issue.number }}
          body: |
            ğŸ¤– **Geminiã‹ã‚‰ã®è¿”ä¿¡:**

            ${{ steps.call-gemini-api.outputs.reply }}